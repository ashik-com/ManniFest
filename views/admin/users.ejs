<%- include('../admin/partials/header') %>
      <!--  Header End -->
      <div class="container-fluid">
        <h2 class="mb-3">User Management</h2>
        <table class="table table-bordered">
            <thead class="table-dark">
                <tr>
                    <th>Profile</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Created Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
              <% users.forEach((user) => { %>
                <tr>
                  <td>
                    <img src="<%= user.profileImage || 'https://via.placeholder.com/40' %>" 
                         class="rounded-circle" 
                         alt="Profile" 
                         width="40" 
                         height="40"
                         loading="lazy">
                  </td>
                  <td><%= user.name %></td>
                  <td><%= user.email %></td>
                  <td><%= user.created_at.toISOString().split('T')[0] %></td>
                  <td>
                    <button style="width: 80px;" class="btn btn-sm <%= user.isBlocked ? 'btn-success' : 'btn-danger' %> block-btn" data-id="<%= user._id %>">
                      <%= user.isBlocked ? 'Unblock' : 'Block' %>
                    </button>
                  </td>
                </tr>
              <% }) %>
            </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
  document.querySelectorAll(".block-btn").forEach((button) => {
    button.addEventListener("click", async function () {
      const userId = this.getAttribute("data-id");
      const isBlocked = this.classList.contains("btn-danger"); 
      const action = isBlocked ? "block" : "unblock"; 

      
      const result = await Swal.fire({
        title: `Are you sure?`,
        text: `Do you really want to ${action} this user?`,
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#d33",
        cancelButtonColor: "#3085d6",
        confirmButtonText: `Yes, ${action} it!`,
        cancelButtonText: "Cancel",
      });

      if (!result.isConfirmed) return;

      try {
        const response = await fetch(`/admin/users/block/${userId}`, {
          method: "PATCH",
          headers: { "Content-Type": "application/json" },
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.message || "Error updating user status");
        }

       
        this.classList.toggle("btn-danger");
        this.classList.toggle("btn-success");
        this.textContent = data.isBlocked ? "Unblock" : "Block";

        
        Swal.fire({
          title: "Success!",
          text: `User has been ${data.isBlocked ? "blocked" : "unblocked"} successfully.`,
          icon: "success",
          timer: 2000,
          showConfirmButton: false,
        });
      } catch (error) {
        console.error("Error:", error);
        Swal.fire("Error", "An error occurred. Please try again.", "error");
      }
    });
  });
});



  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  
 
  <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
  <%- include('../admin/partials/footer') %>