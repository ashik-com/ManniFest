<%- include('../admin/partials/header') %>
 <!-- views/admin/dashboard.ejs -->
<div class="container-fluid">
  <div class="card">
      <div class="card-body">
          <h2 class="mb-4">Admin Dashboard</h2>

          <!-- Sales Chart Section (Bar Chart) -->
          <div class="card mb-4">
              <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                      <h3>Total Sales</h3>
                      <select id="salesTimeFilter" class="form-select" style="width: 200px;">
                          <option value="yearly">Yearly</option>
                          <option value="monthly">Monthly</option>
                          <option value="weekly">Weekly</option>
                          <option value="daily">Daily</option>
                      </select>
                  </div>
                  <canvas id="salesChart" height="100"></canvas>
              </div>
          </div>

          <!-- Order Count Chart Section (Line Chart) -->
          <div class="card mb-4">
              <div class="card-body">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                      <h3>Order Count</h3>
                      <select id="orderTimeFilter" class="form-select" style="width: 200px;">
                          <option value="yearly">Yearly</option>
                          <option value="monthly">Monthly</option>
                          <option value="weekly">Weekly</option>
                          <option value="daily">Daily</option>
                      </select>
                  </div>
                  <canvas id="orderChart" height="100"></canvas>
              </div>
          </div>

          <!-- Best Selling Products -->
          <div class="card mb-4">
              <div class="card-body">
                  <h3>Top 10 Best Selling Products</h3>
                  <table class="table table-striped table-bordered" style="font-size: 14px;">
                      <thead class="table-dark">
                          <tr>
                              <th style="width: 10%;">Rank</th>
                              <th style="width: 40%;">Product Name</th>
                              <th style="width: 25%;">Units Sold</th>
                              <th style="width: 25%;">Revenue</th>
                          </tr>
                      </thead>
                      <tbody>
                          <% if (topProducts && topProducts.length > 0) { %>
                              <% topProducts.forEach((product, index) => { %>
                                  <tr>
                                      <td><%= index + 1 %></td>
                                      <td><%= product.name %></td>
                                      <td><%= product.unitsSold %></td>
                                      <td>₹<%= product.revenue.toFixed(2) %></td>
                                  </tr>
                              <% }) %>
                          <% } else { %>
                              <tr>
                                  <td colspan="4" class="text-center">No data available</td>
                              </tr>
                          <% } %>
                      </tbody>
                  </table>
              </div>
          </div>

          <!-- Best Selling Categories -->
          <div class="card mb-4">
              <div class="card-body">
                  <h3>Top 10 Best Selling Categories</h3>
                  <table class="table table-striped table-bordered" style="font-size: 14px;">
                      <thead class="table-dark">
                          <tr>
                              <th style="width: 10%;">Rank</th>
                              <th style="width: 40%;">Category Name</th>
                              <th style="width: 25%;">Units Sold</th>
                              <th style="width: 25%;">Revenue</th>
                          </tr>
                      </thead>
                      <tbody>
                          <% if (topCategories && topCategories.length > 0) { %>
                              <% topCategories.forEach((category, index) => { %>
                                  <tr>
                                      <td><%= index + 1 %></td>
                                      <td><%= category.name %></td>
                                      <td><%= category.unitsSold %></td>
                                      <td>₹<%= category.revenue.toFixed(2) %></td>
                                  </tr>
                              <% }) %>
                          <% } else { %>
                              <tr>
                                  <td colspan="4" class="text-center">No data available</td>
                              </tr>
                          <% } %>
                      </tbody>
                  </table>
              </div>
          </div>

          <!-- Best Selling Brands -->
          <div class="card mb-4">
              <div class="card-body">
                  <h3>Top 10 Best Selling Brands</h3>
                  <table class="table table-striped table-bordered" style="font-size: 14px;">
                      <thead class="table-dark">
                          <tr>
                              <th style="width: 10%;">Rank</th>
                              <th style="width: 40%;">Brand Name</th>
                              <th style="width: 25%;">Units Sold</th>
                              <th style="width: 25%;">Revenue</th>
                          </tr>
                      </thead>
                      <tbody>
                          <% if (topBrands && topBrands.length > 0) { %>
                              <% topBrands.forEach((brand, index) => { %>
                                  <tr>
                                      <td><%= index + 1 %></td>
                                      <td><%= brand.name %></td>
                                      <td><%= brand.unitsSold %></td>
                                      <td>₹<%= brand.revenue.toFixed(2) %></td>
                                  </tr>
                              <% }) %>
                          <% } else { %>
                              <tr>
                                  <td colspan="4" class="text-center">No data available</td>
                              </tr>
                          <% } %>
                      </tbody>
                  </table>
              </div>
          </div>
      </div>
  </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Sales Chart Data (Bar Chart)
  const salesData = <%- JSON.stringify(salesChartData) %>;
  const salesCtx = document.getElementById('salesChart').getContext('2d');
  const salesChart = new Chart(salesCtx, {
      type: 'bar',
      data: {
          labels: salesData.labels,
          datasets: [{
              label: 'Total Sales (₹)',
              data: salesData.values,
              backgroundColor: '#007bff',
              borderColor: '#0056b3',
              borderWidth: 1
          }]
      },
      options: {
          responsive: true,
          scales: {
              y: { beginAtZero: true }
          }
      }
  });

  // Order Count Chart Data (Line Chart)
  const orderData = <%- JSON.stringify(orderChartData) %>;
  const orderCtx = document.getElementById('orderChart').getContext('2d');
  const orderChart = new Chart(orderCtx, {
      type: 'line',
      data: {
          labels: orderData.labels,
          datasets: [{
              label: 'Order Count',
              data: orderData.values,
              borderColor: '#28a745',
              backgroundColor: 'rgba(40, 167, 69, 0.1)',
              fill: true
          }]
      },
      options: {
          responsive: true,
          scales: {
              y: { beginAtZero: true }
          }
      }
  });

  // Filter Handlers
  document.getElementById('salesTimeFilter').addEventListener('change', function() {
      const filter = this.value;
      window.location.href = `/admin/dashboard?salesFilter=${filter}&orderFilter=${document.getElementById('orderTimeFilter').value}`;
  });

  document.getElementById('orderTimeFilter').addEventListener('change', function() {
      const filter = this.value;
      window.location.href = `/admin/dashboard?salesFilter=${document.getElementById('salesTimeFilter').value}&orderFilter=${filter}`;
  });
</script>
  



  <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>
  <%- include('../admin/partials/footer') %>